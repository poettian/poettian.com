<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-cn">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/blog/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="努力变成一个热爱生活的人">
<meta property="og:type" content="website">
<meta property="og:title" content="poettian | 中点站">
<meta property="og:url" content="https://www.poettian.com/blog/index.html">
<meta property="og:site_name" content="poettian | 中点站">
<meta property="og:description" content="努力变成一个热爱生活的人">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="poettian | 中点站">
<meta name="twitter:description" content="努力变成一个热爱生活的人">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Auteur'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.poettian.com/blog/"/>





  <title>poettian | 中点站</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-cn">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">poettian | 中点站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archieven
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.poettian.com/blog/blog/2018/01/03/Hello-World/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="搬砖的poettian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="poettian | 中点站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/01/03/Hello-World/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Geplaatst op</span>
              
              <time title="Post aangemaakt" itemprop="dateCreated datePublished" datetime="2018-01-03T20:34:58+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2018/01/03/Hello-World/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/03/Hello-World/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>你好，世界！^^</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.poettian.com/blog/blog/2017/11/17/nginx配置之server-name/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="搬砖的poettian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="poettian | 中点站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2017/11/17/nginx配置之server-name/" itemprop="url">nginx配置之server_name</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Geplaatst op</span>
              
              <time title="Post aangemaakt" itemprop="dateCreated datePublished" datetime="2017-11-17T08:48:44+08:00">
                2017-11-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2017/11/17/nginx配置之server-name/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/17/nginx配置之server-name/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="nginx是如何解析请求"><a href="#nginx是如何解析请求" class="headerlink" title="nginx是如何解析请求"></a>nginx是如何解析请求</h3><p>先来看下nginx配置中server的写法：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>      <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span> example.org www.example.org;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>nginx会根据请求头的Host字段来查找和匹配对应的server，如果配置中所有server的server_name都无法匹配该请求，那么nginx就route此请求到<code>ip:port</code>默认的server中。<br>其中，默认的server是配置文件中第一个server，除非明确指定某个server为default server，如下：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>      <span class="number">80</span> default_server;</div><div class="line">    <span class="attribute">server_name</span> example.net www.example.net;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意：默认server是针对ip:port而言的，不同的ip:port分别有不同的default server</p>
</blockquote>
<h3 id="如何阻止nginx处理未带有Host的请求"><a href="#如何阻止nginx处理未带有Host的请求" class="headerlink" title="如何阻止nginx处理未带有Host的请求"></a>如何阻止nginx处理未带有Host的请求</h3><p>如果请求未带有Host请求头，那么可以用如下配置来阻止访问：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>      <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span> <span class="string">""</span>;</div><div class="line">    <span class="attribute">return</span>      <span class="number">444</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>定义为空字符串的server_name 会匹配未带有Host头的请求，然后返回一个nginx 的非标准的444响应码并关闭连接。<br>server_name这一行也可以去掉：</p>
<blockquote>
<p>If no server_name is defined in a server block then nginx uses the empty name as the server name.</p>
</blockquote>
<h3 id="基于ip和name的server"><a href="#基于ip和name的server" class="headerlink" title="基于ip和name的server"></a>基于ip和name的server</h3><p>让我们来看下更加复杂一些的server配置，分别定义了几个监听不同ip的虚拟主机：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>      <span class="number">192.168.1.1:80</span>;</div><div class="line">    <span class="attribute">server_name</span> example.org www.example.org;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>      <span class="number">192.168.1.1:80</span> default_server;</div><div class="line">    <span class="attribute">server_name</span> example.net www.example.net;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>      <span class="number">192.168.1.2:80</span> default_server;</div><div class="line">    <span class="attribute">server_name</span> example.com www.example.com;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>nginx首先检查请求对应的ip和port，找到listen配置能够匹配此请求的server，然后看请求是否匹配server_name，如果不匹配，就route此请求交给此ip:port 的default server来处理。</p>
<h3 id="nginx的server-name详解"><a href="#nginx的server-name详解" class="headerlink" title="nginx的server_name详解"></a>nginx的server_name详解</h3><p>此配置可以用 exact names，通配符和正则表达式来定义。<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span>  example.org  www.example.org;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span>  <span class="regexp">*.example.org</span>;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span>  <span class="regexp">mail.*</span>;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span>  ~^(?&lt;user&gt;.+)\.example\.net$;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果有多个server_name都能匹配某个请求，那么按如下规则，第一个匹配到的server会被选择来处理此请求</p>
<ol>
<li>exact name</li>
<li>最长的以<em>开头的通配符定义，如”</em>.example.org”</li>
<li>最长的以<em>结尾的通配符定义，如”mail.</em>“</li>
<li>第一个匹配的正则表达式(以出现在配置文件的顺序来定)</li>
</ol>
<h4 id="通配符定义"><a href="#通配符定义" class="headerlink" title="通配符定义"></a>通配符定义</h4><p>通配符定义中<em>只能出现在开头或结尾，并以.结尾或开头，”www.</em>.example.org” 和 “w<em>.example.org”都是无效的，但是这些可以用正则表达式来定义，比如”~^www..+.example.org$” 和 “~^w.</em>.example.org$”。<em>匹配部分server name，”</em>.example.org”不仅匹配www.example.org 而且也匹配www.sub.example.org。<br>还有一种特殊的通配符定义”.example.org”，可以用来匹配exact name “example.org” 和 通配符定义 “*.example.org”</p>
<h4 id="正则表达式定义"><a href="#正则表达式定义" class="headerlink" title="正则表达式定义"></a>正则表达式定义</h4><p>nginx使用的是pcre正则，必须用~符号来定义，否则就会被当做是一个exact name 或 通配符定义。^ 和 $ 符号虽然不是语法上必须的，但是最好加上。域名中的.必须用\转义，包含{和}的定义，必须用双引号外括：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">server_name</span>  <span class="string">"~^(?&lt;name&gt;\w\d&#123;1,3&#125;+)\.example\.net$"</span>;</div></pre></td></tr></table></figure></p>
<p>正则中的捕获，可以作为变量用在后面：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">server_name</span>   ~^(www\.)?(?&lt;domain&gt;.+)$;</div><div class="line"></div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">root</span>   /sites/<span class="variable">$domain</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">server_name</span>   ~^(www\.)?(.+)$;</div><div class="line"></div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">root</span>   /sites/<span class="variable">$2</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>The PCRE library supports named captures using the following syntax:</p>
<p>?<name>    Perl 5.10 compatible syntax, supported since PCRE-7.0<br>?’name’    Perl 5.10 compatible syntax, supported since PCRE-7.0<br>?P<name>    Python compatible syntax, supported since PCRE-4.0</name></name></p>
<h3 id="其他的内容过于复杂，暂时略过"><a href="#其他的内容过于复杂，暂时略过" class="headerlink" title="其他的内容过于复杂，暂时略过"></a>其他的内容过于复杂，暂时略过</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.poettian.com/blog/blog/2017/11/14/ThinkPHP下的代码分层思考/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="搬砖的poettian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="poettian | 中点站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2017/11/14/ThinkPHP下的代码分层思考/" itemprop="url">ThinkPHP下的代码分层思考</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Geplaatst op</span>
              
              <time title="Post aangemaakt" itemprop="dateCreated datePublished" datetime="2017-11-14T09:25:03+08:00">
                2017-11-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2017/11/14/ThinkPHP下的代码分层思考/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/14/ThinkPHP下的代码分层思考/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>公司一直在用国产框架ThinkPHP做开发，上半年进行了一次代码重构， 使用了最新的thinkphp 5，虽然相较之前版本代码结构更加清晰合理，可依然有比较混乱的地方。随着开发进度已接近尾声，重新架构已经不可能，但有必要做一个梳理，方便以后升级参考和后续优化。</p>
<p>结合ThinkPHP手册的说明，暂时给出一个我觉得合理的分层结构，如下：</p>
<p>|–Application<br>|    |–common/ 公共模块，统一存放：行为，数据层，枚举，逻辑层，业务层等<br>|    |    |–behavior/ 行为，权限检测，模板处理等等<br>|    |    |–model/ 数据层，读取和更新数据<br>|    |    |–enum/ 枚举字段数值定义和说明<br>|    |    |–logic/ 逻辑层，调用数据层和其他逻辑层进行业务处理，抛异常方式返回错误信息<br>|    |    |–service/ 服务层，提供：参数校验，行为调用，事务开启，逻辑调用和异常捕获，数据过滤等服务<br>|    |    …<br>|    |–admin/ 后台模块<br>|    |    |–controller/ 调用服务层，数据格式化<br>|    |–home/ 前台模块<br>|    |–api/ 接口模块<br>|    |    |–controller/ 调用服务层，数据格式化<br>|–extend/<br>|    |–util/ 工具箱<br>|    …<br>|–vendor/ composer文件<br>…</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.poettian.com/blog/blog/2017/11/02/LNMP架构中的buffer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="搬砖的poettian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="poettian | 中点站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2017/11/02/LNMP架构中的buffer/" itemprop="url">LNMP架构中的buffer机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Geplaatst op</span>
              
              <time title="Post aangemaakt" itemprop="dateCreated datePublished" datetime="2017-11-02T08:46:16+08:00">
                2017-11-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/后端技术/" itemprop="url" rel="index">
                    <span itemprop="name">后端技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2017/11/02/LNMP架构中的buffer/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/02/LNMP架构中的buffer/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前一直对PHP的 ob_* 系统函数存在疑惑，始终没明白php和webserver的buffer机制，百度谷歌搜到的都是千篇一律的文章，自己测试也走不通，直到看了 “<em><a href="http://www.jianshu.com/p/1a020dfe9e39" title="php out buffer" target="_blank" rel="external">PHP out buffer</a></em>“ 这篇文章才有种恍然大悟的感觉。</p>
<p>借用作者的一张图，如下：</p>
<img src="/blog/2017/11/02/LNMP架构中的buffer/图1.png" alt="PHP buffer flow" title="PHP buffer flow">
<h3 id="php的buffer"><a href="#php的buffer" class="headerlink" title="php的buffer"></a>php的buffer</h3><p>通过设置 php.ini 中 output_buffering 参数来控制php缓存输出数据（通过echo或print等）的大小，超过该大小，则php就会将数据发送出去给下一个接收者(php-fpm)。设为off，则php关闭缓冲区。</p>
<h3 id="php-fpm的buffer"><a href="#php-fpm的buffer" class="headerlink" title="php-fpm的buffer"></a>php-fpm的buffer</h3><p>之前一直不知道这个的存在，好像是写死在程序中的，没法配置，默认大小是8k。</p>
<h3 id="nginx的buffer"><a href="#nginx的buffer" class="headerlink" title="nginx的buffer"></a>nginx的buffer</h3><p>nginx的 ngx_http_fastcgi_module 通过下面这几个参数来配置buffering的行为：</p>
<p><strong>fastcgi_buffering on|off;</strong> 开启/关闭 buffer<br><strong>fastcgi_buffer_size 4k;</strong> 用来缓存fastcgi response的header数据<br><strong>fastcgi_buffers 8 4k;</strong> 用来缓存fastcgi response的内容数据，当response数据大于此值（4k）时，就会发送response给client，而client就开始下载数据<br><strong>fastcgi_busy_buffers_size 8k;</strong> 用来控制同时传输到客户端的buffer数量，当fastcgi response源源不断的过来，此参数定义了处于busy状态下的发送response给client的buffer的数量<br>参数间关系：fastcgi_busy_buffers_size&lt;(all fastcgi_buffers - one buffer) 并且fastcgi_busy_buffers_size&gt;=max (fastcgi_buffer_size, one fastcgi _buffers)</p>
<p>当fastcgi response比较大时，如果超出了fastcgi_buffers设定的值，那么就会将response存入temp file，此时由<strong>fastcgi_max_temp_file_size(临时文件的大小，默认1024m) </strong>和<strong> fastcgi_temp_file_write_size(每次写入临时文件的数据大小)</strong> 这两个参数来控制</p>
<blockquote>
<p>参看error.log会看到如下信息：_an upstream response is buffered to a temporary file /usr/local/var/run/nginx/fastcgi<em>temp/4/00/0000000004 while reading upstream, client: 127.0.0.1, server: test.poettian.org, request: “GET / HTTP/1.1”, upstream: “fastcgi://unix:/usr/local/var/run/php-fpm.sock:”, host: “test.poettian.org”</em></p>
</blockquote>
<p>可以通过设置fastcgi response header中<strong>X-Accel-Buffering</strong>字段的值为no来禁用buffering</p>
<p>可以参考如下的代码，这段代码可以实现每秒输出一个数字的效果：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">10</span>; $i++) &#123;</div><div class="line">	<span class="keyword">echo</span> $i;</div><div class="line">	<span class="keyword">echo</span> str_repeat(<span class="string">' '</span>, <span class="number">4096</span>) . <span class="string">"&lt;br /&gt;"</span>;</div><div class="line">	ob_flush(); <span class="comment">//ob_flush()可以刷新php的缓冲区</span></div><div class="line">	flush(); <span class="comment">//flush()可以刷新php-fpm的缓冲区</span></div><div class="line">	sleep(<span class="number">1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="apache的缓冲区"><a href="#apache的缓冲区" class="headerlink" title="apache的缓冲区"></a>apache的缓冲区</h3><p>当php的输出数据给apache服务器时，它也会做一层buffer（也将数据放入它的缓冲区，当缓冲区数据满或执行完毕时，才输出数据）。若想关闭缓冲区，可以在php层使用flush()来强制将缓冲区数据输出。fulsh() 的工作原理：在apache module的sapi下, flush会通过调用sapi_module的flush成员函数指针, 间接的调用apache的api: ap_rflush刷新apache的输出缓冲区, 当然手册中也说了, 有一些apache的其他模块, 可能会改变这个动作的结果.例如mod_gzip，可能自己进行输出缓冲区，这将导致flush()函数产生的结果不会立即被发送到客户端浏览器。</p>
<h3 id="php的自定义缓冲区："><a href="#php的自定义缓冲区：" class="headerlink" title="php的自定义缓冲区："></a>php的自定义缓冲区：</h3><p>PHP内核中，除了默认的输出缓冲区之外，用户也可以自己定义输出缓冲区，也就是ob_系列函数了。<br>(1)、可以通过ob_start函数激活一个缓冲区，激活的缓存区被压入栈中(OG(handlers))，多次调用ob_start函数会生成一个缓冲区栈。<br>开启output_buffering配置后，PHP内核默认输出缓冲区处于OG(handlers)的栈底。<br>(2)、通过ob_get_contents函数可以获取OG(handlers)栈顶部缓冲区(称之为active)的内容。<br>(3)、通过ob_flush函数可以将active缓冲区的内容冲刷到active缓冲区的上一级缓冲区(栈顶的下一位)，如果active已经处于栈底，那么冲刷active缓冲区会将其内容输出到SAPI(正如在三中所看到的)。<br>(4)、通过ob_end_flush函数除了将active缓冲区的内容冲刷出去外，还会将当前缓冲区从栈顶弹出。</p>
<h3 id="其他php配置"><a href="#其他php配置" class="headerlink" title="其他php配置"></a>其他php配置</h3><p><strong>implicit_flush配置和ob_implicit_flush函数</strong><br>其中，如果将php.ini配置中的implicit_flush设置为1, 或者调用ob_implicit_flush(true)，那么就不需要调用flush函数了，他们都会刷新PHP-FPM缓冲区中的内容。<br>至于 cli，它的implicit_flush硬编码为1，它的output_buffering也是设置为0。</p>
<h3 id="疑惑"><a href="#疑惑" class="headerlink" title="疑惑"></a>疑惑</h3><p>有个地方比较疑惑，见如下代码：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">10</span>; ++$i) &#123;</div><div class="line">	<span class="keyword">echo</span> $i;</div><div class="line">	ob_flush();</div><div class="line">	flush();</div><div class="line">	sleep(<span class="number">1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>预期是每次输出一个数字，但是实际测试是前4个数字一起输出，然后才是一次输出一个数字，不知道为什么。如果在代码最前面加上<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">echo</span> str_repeat(<span class="string">' '</span>, <span class="number">4</span>);</div></pre></td></tr></table></figure></p>
<p>就可以了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.poettian.com/blog/blog/2017/05/26/PHP应用的压测和性能分析案例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="搬砖的poettian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="poettian | 中点站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2017/05/26/PHP应用的压测和性能分析案例/" itemprop="url">PHP应用的压测和性能分析案例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Geplaatst op</span>
              
              <time title="Post aangemaakt" itemprop="dateCreated datePublished" datetime="2017-05-26T10:28:20+08:00">
                2017-05-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2017/05/26/PHP应用的压测和性能分析案例/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/26/PHP应用的压测和性能分析案例/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近公司有个项目准备上线，为了保证上线后应用的正常运行和访问速度，着手进行压测和优化，虽然目前为止未能找到并发情况下QPS比较低的原因，但多多少少有些收获。 下面就这一过程做个记录，准备公司内部分享，也借鉴一下同事们的经验。</p>
<h3 id="先介绍一下配置和用到的工具"><a href="#先介绍一下配置和用到的工具" class="headerlink" title="先介绍一下配置和用到的工具"></a>先介绍一下配置和用到的工具</h3><p>线上机器和部署情况（阿里云）：</p>
<blockquote>
<p>服务器2台 16核 32G内存 PHP5.4<br>负载均衡 带宽100M<br>云数据库RDS MYSQL5.6<br>NAS云盘 挂载在两台服务器的相同目录下</p>
</blockquote>
<p>php-fpm 部分配置情况</p>
<blockquote>
<p>error_log = /usr/local/php/var/log/php-fpm.log<br>pm = dynamic<br>pm.max_children = 500<br>pm.start_servers = 16<br>pm.min_spare_servers = 16<br>pm.max_spare_servers = 500<br>pm.max_requests = 600<br>request_terminate_timeout = 300<br>request_slowlog_timeout = 0<br>slowlog = var/log/slow.log</p>
</blockquote>
<p>压测工具：</p>
<blockquote>
<p>loadrunner HP的一个经典的压测工具，运行在windows环境<br>ApacheBench 简称ab，apache自带的一个压测工具，运行在linux环境</p>
</blockquote>
<p>分析工具：</p>
<blockquote>
<p>phptrace 360的一款用于跟踪、分析PHP运行情况的工具，需要安装相应的php扩展<br>xhprof facebook开源的一款分析工具，也需要安装相应的php扩展。可以搭配xhgui进行视图化，但是xhgui的安装需要mongodb，就没装</p>
</blockquote>
<h3 id="开始压测和分析"><a href="#开始压测和分析" class="headerlink" title="开始压测和分析"></a>开始压测和分析</h3><p>以网站首页为例</p>
<p>用ab给到100的并发<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ab -s 60 -n 2000 -c 100 -H &apos;Accept-Encoding: gzip&apos; -l http://ysc.baidu.com/</div><div class="line"></div><div class="line">参数含义：</div><div class="line">-s 60 每个请求允许的最大等待时间设为60秒</div><div class="line">-n 2000 一共执行2000个请求</div><div class="line">-c 100 每次的并发量设为100</div><div class="line">-H header头信息，这里是告诉服务器将响应数据用gzip压缩，减少带宽压力</div><div class="line">-l 允许响应数据大小发生变动，如果是静态网页，可以不要此参数，但如果是动态网页，最好加上这个参数，否则有些响应就计入failed统计</div></pre></td></tr></table></figure></p>
<p>看下执行的情况</p>
<p>能够看到，QPS很低，服务器每秒能够处理的请求基本在7个左右，响应时间大概在15s</p>
<p>又进行了一次压测，这次去掉了业务的执行，单纯跑框架，结果QPS也只能达到十几，好尴尬！那就说明，框架本身的执行速度就不快，更别论业务的执行对响应时间的影响了。</p>
<p>可能的原因：<br>1.cpu负载超了<br>2.io负载高，io发生阻塞或io速度慢<br>3.php-fpm进程不够，请求阻塞在php-fpm上<br>4.带宽占满<br>5.php-fpm进程执行中出现的其他问题<br>6.代码问题</p>
<h5 id="先来排查cpu负载"><a href="#先来排查cpu负载" class="headerlink" title="先来排查cpu负载"></a>先来排查cpu负载</h5><p>用 <strong>top</strong> 或 <strong>mpstat</strong> 命令查看cpu的负载情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mpstat -P ALL 2 3</div></pre></td></tr></table></figure></p>
<p>执行情况<br><img src="http://oqjjg4tjz.bkt.clouddn.com/2017-05-26-14957688652078.jpg" alt="cpu负载情况"></p>
<p>发现cpu负载都很低，但是有一核几乎跑满了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps aux</div></pre></td></tr></table></figure>
<p>发现是一个php进程的问题</p>
<p><img src="http://oqjjg4tjz.bkt.clouddn.com/2017-05-26-14957788435179.jpg" alt=""></p>
<p>这个脚本中有无限循环的情况，类似<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;&#125;</div></pre></td></tr></table></figure></p>
<p>干掉这个进程，明显的cpu负载就下来了</p>
<p>ok，以上说明cpu负载并不是导致QPS的原因</p>
<h5 id="再来排查io"><a href="#再来排查io" class="headerlink" title="再来排查io"></a>再来排查io</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iostat -dx 1 5</div></pre></td></tr></table></figure>
<p><img src="http://oqjjg4tjz.bkt.clouddn.com/2017-05-26-14957792674529.jpg" alt=""></p>
<p>解释：</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rrqm/s</td>
<td>队列中每秒钟合并的读请求数量</td>
</tr>
<tr>
<td>wrqm/s</td>
<td>队列中每秒钟合并的写请求数量</td>
</tr>
<tr>
<td>r/s</td>
<td>每秒钟完成的读请求数量</td>
</tr>
<tr>
<td>w/s</td>
<td>每秒钟完成的写请求数量</td>
</tr>
<tr>
<td>rsec/s</td>
<td>每秒钟读取的扇区数量</td>
</tr>
<tr>
<td>wsec/s</td>
<td>每秒钟写入的扇区数量</td>
</tr>
<tr>
<td>avgrq-sz</td>
<td>平均请求扇区的大小</td>
</tr>
<tr>
<td>avgqu-sz</td>
<td>平均请求队列的长度</td>
</tr>
<tr>
<td>await</td>
<td>平均每次请求的等待时间</td>
</tr>
<tr>
<td>util</td>
<td>设备的利用率</td>
</tr>
</tbody>
</table>
<p>下面是关键列的解释：<br>    <font color="red"><br>    util是设备的利用率。如果它接近100%，通常说明设备能力趋于饱和。<br>    await是平均每次请求的等待时间。这个时间包括了队列时间和服务时间，也就是说，一般情况下，await大于svctm，它们的差值越小，则说明队列时间越短，反之差值越大，队列时间越长，说明系统出了问题。<br>    avgqu-sz是平均请求队列的长度。毫无疑问，队列长度越短越好。<br>    </font></p>
<p>可知，问题也不是出在io上</p>
<h5 id="难道是php-fpm的进程不够？"><a href="#难道是php-fpm的进程不够？" class="headerlink" title="难道是php-fpm的进程不够？"></a>难道是php-fpm的进程不够？</h5><p>看php-fpm的配置，完全没有问题，最大子进程已经设置成了500，应该不是php-fpm进程不够的原因</p>
<p>开启压测，查看php-fpm.log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tail -f var/log/php-fpm.log</div></pre></td></tr></table></figure>
<p><img src="http://oqjjg4tjz.bkt.clouddn.com/2017-05-26-14957800885061.jpg" alt=""></p>
<p>可见php-fpm的进程数也上来了，也排除了这个可能</p>
<h5 id="追究具体的php-fpm进程"><a href="#追究具体的php-fpm进程" class="headerlink" title="追究具体的php-fpm进程"></a>追究具体的php-fpm进程</h5><p>接下来只能追踪具体某个php-fpm进程的执行流程了，好在有phptrace这个利器，官网 <a href="https://github.com/Qihoo360/phptrace" target="_blank" rel="external">https://github.com/Qihoo360/phptrace</a> ，它能分析具体脚本中的执行流程和调用关系，并给出具体的执行时间，从而能够查探到你的程序卡在了哪里。</p>
<p>话不多说，直接执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">phptrace -p 10875 &gt; /tmp/phptrace.log</div></pre></td></tr></table></figure></p>
<p>把结果保存到文件中，ok，接下来分析这个文件，由于行数太多，这里截取几行能够说明就够了</p>
<p><img src="http://oqjjg4tjz.bkt.clouddn.com/2017-05-26-14957808316856.jpg" alt=""></p>
<p>是不是很清晰明了。在分析这个脚本的过程中，发现 <strong>require</strong> 占用了很大的一部分时间，几乎每个 require 要占用0.06s</p>
<p>发生了什么？是进程在系统调用上有什么比较耗时的步骤吗？那就来看这个进程的系统调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">strace -p 10805 -tt -T -e trace=all -o /tmp/strace.log</div></pre></td></tr></table></figure>
<p>分析结果，显示open(file)的耗时比较严重，close()的时间和open差不多，那就说明还是卡在了io上。</p>
<p>这时候，另一个利器出场了！opcache，关于opcache的介绍，自行google，总之它的作用就是缓存php的opcode，节省了对脚步的语法检查，编译的时间，但是它有刷新时间，刷新时间内对文件的变动会无效，这也是缓存系统都有的问题，当然，你可以手动刷新。</p>
<p>接下来继续压测实验，只跑框架，以下是压测结果中只看open()速度的对比：</p>
<table>
<thead>
<tr>
<th>并发量</th>
<th>开启opcache</th>
<th>不开启opcache</th>
</tr>
</thead>
<tbody>
<tr>
<td>50</td>
<td>~0.045s</td>
<td>~0.051s</td>
</tr>
<tr>
<td>100</td>
<td></td>
<td>~0.11s</td>
</tr>
</tbody>
</table>
<p>好像opcache的作用并不是很大，依然有open(file)的调用</p>
<p>为了排除是NAS云盘io读取速度慢的可能，接下来新起了个域名，根目录指向系统盘，再次测试，结果QPS明显上来了，用strace查看进程，发现open(file)速度也明显快了，基本在 ~0.0000*s上</p>
<p>可见，罪魁祸首就是NAS云盘io读取速度慢。</p>
<p>那么什么是NAS？自行百度和谷歌吧！</p>
<hr>
<p>既然是这样，那一般多服务器的分布式共享存储都是怎么实现的呢？下一篇文章揭晓</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">搬砖的poettian</p>
              <p class="site-description motion-element" itemprop="description">努力变成一个热爱生活的人</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/blog/archives/">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categorieën</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">labels</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">搬砖的poettian</span>

  
</div>


  <div class="powered-by">Mede mogelijk gemaakt door <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Thema &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/blog/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blog/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    

  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
